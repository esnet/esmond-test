<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &mdash; esmond 0.9.1a1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.1a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="esmond 0.9.1a1 documentation" href="index.html" />
    <link rel="next" title="Deployment Cookbook" href="deployment_cookbook.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="deployment_cookbook.html" title="Deployment Cookbook"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">esmond 0.9.1a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="esmond-root">
<h3><tt class="docutils literal"><span class="pre">ESMOND_ROOT</span></tt><a class="headerlink" href="#esmond-root" title="Permalink to this headline">¶</a></h3>
<p>The standard root directory for all esmond configuration and data.  esmond
will not start unless <tt class="docutils literal"><span class="pre">ESMOND_ROOT</span></tt> is set.</p>
</div>
<div class="section" id="esmond-conf">
<h3><tt class="docutils literal"><span class="pre">ESMOND_CONF</span></tt><a class="headerlink" href="#esmond-conf" title="Permalink to this headline">¶</a></h3>
<p>This specifies the location of <tt class="docutils literal"><span class="pre">esmond.conf</span></tt>.</p>
</div>
<div class="section" id="esmond-testing">
<h3><tt class="docutils literal"><span class="pre">ESMOND_TESTING</span></tt><a class="headerlink" href="#esmond-testing" title="Permalink to this headline">¶</a></h3>
<p>Setting this environment variable will cause esmond to use SQLite for it&#8217;s
SQL database instead of whatever is configured in <tt class="docutils literal"><span class="pre">esmond.conf</span></tt>.</p>
</div>
</div>
<div class="section" id="config-file">
<h2>Config File<a class="headerlink" href="#config-file" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Probably should move this into the code that does the config to make it
easier to keep it in sync.</p>
</div>
<p>esmond uses an INI style config file.  By default the config file is located
at <tt class="docutils literal"><span class="pre">${ESMOND_ROOT}/esmond.conf</span></tt>.  The <tt class="docutils literal"><span class="pre">${ESMOND_CONF}</span></tt> enviroment
variable allows overriding the location of the config file.  The value of
<tt class="docutils literal"><span class="pre">ESMOND_ROOT</span></tt> is available within the config file.</p>
<p>Here is an example <tt class="docutils literal"><span class="pre">esmond.conf</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre>[main]
sql_db_engine = django.db.backends.sqlite3
sql_db_name = %(ESMOND_ROOT)s/esmond.db
tsdb_root = %(ESMOND_ROOT)s/tsdb-data
tsdb_chunk_prefixes = %(ESMOND_ROOT)s/tsdb-data
api_anon_limit = 30
api_throttle_at =
api_throttle_timeframe =
api_throttle_expiration =
cassandra_servers = localhost:9160
cassandra_user =
cassandra_pass =
db_profile_on_testing = no
profile_persister = no
mib_dirs = %(ESMOND_ROOT)s/mibs
mibs =
syslog_facility = local7
syslog_priority = debug
traceback_dir = %(ESMOND_ROOT)s/crashlog
pid_dir = %(ESMOND_ROOT)s/var/
espersistd_uri = 127.0.0.1:11211
espoll_persist_uri = MemcachedPersistHandler:127.0.0.1:11211
htpasswd_file = %(ESMOND_ROOT)s/htpasswd
[persist_map]
FastPollHC = cassandra
FastPoll = cassandra
JnxFirewall = cassandra
JnxCOS = cassandra
Errors = cassandra
ALUFastPollHC = cassandra
ALUErrors = cassandra
ALUIfRefPoll = aluifref
SentryPoll = cassandra
ALUSAPRefPoll = alusapref
ALUSAPPoll = cassandra
IfRefPoll = ifref
[persist_queues]
cassandra = CassandraPollPersister:9
ifref = IfRefPollPersister:1
infifref = InfIfRefPollPersister:1
aluifref = ALUIfRefPollPersister:1
alusapref = ALUSAPRefPersister:1
</pre></div>
</div>
<div class="section" id="sql-db">
<h3>sql_db_*<a class="headerlink" href="#sql-db" title="Permalink to this headline">¶</a></h3>
<p>sql_db_engine, sql_db_host, sql_db_port, sql_db_user, sql_db_password,
sql_db_name are the same as their Django counterparts.</p>
</div>
<div class="section" id="cassandra">
<h3>cassandra_*<a class="headerlink" href="#cassandra" title="Permalink to this headline">¶</a></h3>
<p>Connection string info for cassandra backend.  cassandra_servers can be a
comma-delimited list of servers if using a ring.</p>
</div>
<div class="section" id="api-anon-limit">
<h3>api_anon_limit<a class="headerlink" href="#api-anon-limit" title="Permalink to this headline">¶</a></h3>
<p>Limits the number of queries a non-authenticated client can request from the
REST api /bulk/ data endpoint.</p>
</div>
<div class="section" id="espoll-persist-uri">
<h3>espoll_persist_uri<a class="headerlink" href="#espoll-persist-uri" title="Permalink to this headline">¶</a></h3>
<p>This tells <cite>espolld</cite> where to find the work queue for data persistence.  It is
of the form handler:ip_addr:port.  Currently the only handler implemented is
the MemcachedPersistHandler.</p>
</div>
<div class="section" id="htpasswd-file">
<h3>htpasswd_file<a class="headerlink" href="#htpasswd-file" title="Permalink to this headline">¶</a></h3>
<p>This is location of the password file that is used by <cite>newdb</cite></p>
</div>
<div class="section" id="mib-dirs">
<h3>mib_dirs<a class="headerlink" href="#mib-dirs" title="Permalink to this headline">¶</a></h3>
<p>This is a comma separated list of directories additional MIBs can be found.  DLNetSNMP
automatically includes the system MIB dir in the MIB path.</p>
</div>
<div class="section" id="mibs">
<h3>mibs<a class="headerlink" href="#mibs" title="Permalink to this headline">¶</a></h3>
<p>This is a comma separated list of MIBs to load at startup time.</p>
</div>
<div class="section" id="pid-dir">
<h3>pid_dir<a class="headerlink" href="#pid-dir" title="Permalink to this headline">¶</a></h3>
<p>Directory to store pid files in.</p>
</div>
<div class="section" id="syslog-facility">
<h3>syslog_facility<a class="headerlink" href="#syslog-facility" title="Permalink to this headline">¶</a></h3>
<p>Controls which syslog facility esmond uses for logging.</p>
</div>
<div class="section" id="syslog-priority">
<h3>syslog_priority<a class="headerlink" href="#syslog-priority" title="Permalink to this headline">¶</a></h3>
<p>Controls the verbosity of log messages sent to syslog.  Defaults to info.</p>
</div>
<div class="section" id="traceback-dir">
<h3>traceback_dir<a class="headerlink" href="#traceback-dir" title="Permalink to this headline">¶</a></h3>
<p>When an esmond daemon crashes the system makes an effort to save a traceback
for later fault analysis.  This controls where those files are logged.</p>
</div>
<div class="section" id="tsdb-chunk-prefixes">
<h3>tsdb_chunk_prefixes<a class="headerlink" href="#tsdb-chunk-prefixes" title="Permalink to this headline">¶</a></h3>
<p>TSDB implements a simple union filesystem for data storage.  This is a comma
separated list of the directories to be used.</p>
</div>
<div class="section" id="tsdb-root">
<h3>tsdb_root<a class="headerlink" href="#tsdb-root" title="Permalink to this headline">¶</a></h3>
<p>This is the path to the top (write) layer of the TSDB.  It should be the same
as the first component of of tsdb_chunk_prefixes.</p>
</div>
<div class="section" id="persist-map-and-persist-queues">
<h3>persist_map and persist_queues<a class="headerlink" href="#persist-map-and-persist-queues" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">persist_map</span></tt> specifies which queue(s) data from a given <tt class="docutils literal"><span class="pre">OIDSet</span></tt> is
placed in.  The queue names are comma separated.  <tt class="docutils literal"><span class="pre">persist_queues</span></tt> specifies
what persister is used to store the data put into that queue.</p>
<p>The default configuration should be fine for most situations.  Here is the
default config:</p>
<div class="highlight-python"><div class="highlight"><pre>[persist_map]
FastPollHC = tsdb
FastPoll = tsdb
InfFastPollHC = tsdb
JnxFirewall = tsdb
JnxCOS = tsdb
Errors = tsdb
IfRefPoll = ifref
[persist_queues]
tsdb = TSDBPollPersister:8
ifref = IfRefPollPersister:1
</pre></div>
</div>
<div class="section" id="creating-the-sql-database">
<h4>Creating the SQL Database<a class="headerlink" href="#creating-the-sql-database" title="Permalink to this headline">¶</a></h4>
<p>The database defined by the sql_db_* directives need to be loaded with the
schema defined by the django models in esmond/api/models.py.</p>
<p>python esmond/manage.py syncdb</p>
</div>
<div class="section" id="configuring-collection">
<h4>Configuring Collection<a class="headerlink" href="#configuring-collection" title="Permalink to this headline">¶</a></h4>
<p>Data collection is controlled by the configuration stored in the database.  A
<cite>device</cite> is any device from which data needs to be extracted.  Each device can
#be configured to have one or more <cite>OIDSet</cite> s collected.  An OIDSet is a list of
(generally) related <cite>OID</cite> s to collect together.</p>
<p>An initial set of OIDs and OIDSets is included in src/sql/testdata.sql.</p>
<p>To add a device to esmond you need to do:</p>
<blockquote>
<div><dl class="docutils">
<dt>INSERT INTO device (name, begin_time, end_time, community, active)</dt>
<dd>VALUES (&#8216;test-router&#8217;, &#8216;NOW&#8217;, &#8216;infinity&#8217;, &#8216;public&#8217;, true);</dd>
</dl>
</div></blockquote>
<p>name should be the DNS name of the device.  I certainly hope you aren&#8217;t using
&#8216;public&#8217; for your community.</p>
<p>Once the device has been added you need to define some OIDSets to poll on that
device.  The OIDSets definied in testdata.sql are IfRefPoll, FastPoll and
FastPollHC.  IfRefPoll collects information about the interface such as it&#8217;s
speed, it&#8217;s description, etc.  FastPoll and FastPollHC collect
if{In,Out}Octets and ifHC{In,Out}Octets respectively.  To add a OIDSet to be
polled for a device do:</p>
<blockquote>
<div><dl class="docutils">
<dt>INSERT INTO DeviceOIDSetMap (DeviceId, OIDSetId)</dt>
<dd>VALUES (DeviceId, OIDSetId);</dd>
</dl>
</div></blockquote>
<div class="section" id="testing-polling">
<h5>Testing Polling<a class="headerlink" href="#testing-polling" title="Permalink to this headline">¶</a></h5>
<p>You can check to see what the results of polling a device would look like by
using the <cite>espoll</cite> tool.  For example:</p>
<blockquote>
<div>$ bin/espoll -f /path/to/esmond/conf router oidset</div></blockquote>
</div>
<div class="section" id="start-data-collection">
<h5>Start Data Collection<a class="headerlink" href="#start-data-collection" title="Permalink to this headline">¶</a></h5>
<p>To start collection you need to start the polling and persistence daemons:</p>
<blockquote>
<div>$ bin/espersistd -f /path/to/esmond.conf
$ bin/espolld -f /path/to/esmond.conf</div></blockquote>
<p>To monitor the progress of the polling and persisting do:</p>
<blockquote>
<div>$ bin/espersistd -f /path/to/esmond.conf -r stats</div></blockquote>
<p>You should also see messages in syslog.</p>
</div>
<div class="section" id="performance-tuning">
<h5>Performance Tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this headline">¶</a></h5>
<p>Presently TSDB is very I/O intensive.  The current deployment at ESnet uses a
SSD as the top level storage.</p>
</div>
<div class="section" id="setting-up-esdbd-standalone">
<h5>Setting up <cite>esdbd</cite> standalone<a class="headerlink" href="#setting-up-esdbd-standalone" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>$ bin/esdbd -f /path/to/esmond.conf</div></blockquote>
</div>
<div class="section" id="setting-up-esdbd-with-mod-wsgi">
<h5>Setting up <cite>esdbd</cite> with mod_wsgi<a class="headerlink" href="#setting-up-esdbd-with-mod-wsgi" title="Permalink to this headline">¶</a></h5>
<p>To be written, there is a example wsgi wrapper in util.</p>
</div>
<div class="section" id="graphite-integration">
<h5>Graphite Integration<a class="headerlink" href="#graphite-integration" title="Permalink to this headline">¶</a></h5>
<p>Use Store in esmond.graphite_store as the data store for Graphite.  This
section needs to be signficantly fleshed out.</p>
</div>
<div class="section" id="care-and-feeding">
<h5>Care and Feeding<a class="headerlink" href="#care-and-feeding" title="Permalink to this headline">¶</a></h5>
<p>If you&#8217;re using a two level data store take a look at migrate-tsdb-chunks in
util.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a><ul>
<li><a class="reference internal" href="#esmond-root"><tt class="docutils literal"><span class="pre">ESMOND_ROOT</span></tt></a></li>
<li><a class="reference internal" href="#esmond-conf"><tt class="docutils literal"><span class="pre">ESMOND_CONF</span></tt></a></li>
<li><a class="reference internal" href="#esmond-testing"><tt class="docutils literal"><span class="pre">ESMOND_TESTING</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#config-file">Config File</a><ul>
<li><a class="reference internal" href="#sql-db">sql_db_*</a></li>
<li><a class="reference internal" href="#cassandra">cassandra_*</a></li>
<li><a class="reference internal" href="#api-anon-limit">api_anon_limit</a></li>
<li><a class="reference internal" href="#espoll-persist-uri">espoll_persist_uri</a></li>
<li><a class="reference internal" href="#htpasswd-file">htpasswd_file</a></li>
<li><a class="reference internal" href="#mib-dirs">mib_dirs</a></li>
<li><a class="reference internal" href="#mibs">mibs</a></li>
<li><a class="reference internal" href="#pid-dir">pid_dir</a></li>
<li><a class="reference internal" href="#syslog-facility">syslog_facility</a></li>
<li><a class="reference internal" href="#syslog-priority">syslog_priority</a></li>
<li><a class="reference internal" href="#traceback-dir">traceback_dir</a></li>
<li><a class="reference internal" href="#tsdb-chunk-prefixes">tsdb_chunk_prefixes</a></li>
<li><a class="reference internal" href="#tsdb-root">tsdb_root</a></li>
<li><a class="reference internal" href="#persist-map-and-persist-queues">persist_map and persist_queues</a><ul>
<li><a class="reference internal" href="#creating-the-sql-database">Creating the SQL Database</a></li>
<li><a class="reference internal" href="#configuring-collection">Configuring Collection</a><ul>
<li><a class="reference internal" href="#testing-polling">Testing Polling</a></li>
<li><a class="reference internal" href="#start-data-collection">Start Data Collection</a></li>
<li><a class="reference internal" href="#performance-tuning">Performance Tuning</a></li>
<li><a class="reference internal" href="#setting-up-esdbd-standalone">Setting up <cite>esdbd</cite> standalone</a></li>
<li><a class="reference internal" href="#setting-up-esdbd-with-mod-wsgi">Setting up <cite>esdbd</cite> with mod_wsgi</a></li>
<li><a class="reference internal" href="#graphite-integration">Graphite Integration</a></li>
<li><a class="reference internal" href="#care-and-feeding">Care and Feeding</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="deployment_cookbook.html"
                        title="next chapter">Deployment Cookbook</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/config.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="deployment_cookbook.html" title="Deployment Cookbook"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">esmond 0.9.1a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2013, The Regents of the University of California.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>