<!DOCTYPE html>
<!--
render: None 
emb: False 
nosb: 
sbs: None
-->


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>api.api &mdash; esmond 0.9.1a1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.1a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="esmond 0.9.1a1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><img src="../../_static/logo-esnet-ball-sm.png">
          esmond</a>
        <span class="navbar-text navbar-version pull-left"><b>0.9.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Section <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment_cookbook.html">Deployment Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">esmond subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hacking.html">Hacking on esmond</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">api Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.client.html">client Package</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <h1>Source code for api.api</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">calendar</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.utils.timezone</span> <span class="kn">import</span> <span class="n">make_aware</span><span class="p">,</span> <span class="n">utc</span>
<span class="kn">from</span> <span class="nn">django.utils.timezone</span> <span class="kn">import</span> <span class="n">now</span> <span class="k">as</span> <span class="n">django_now</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>

<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span><span class="p">,</span> <span class="n">Resource</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">ALL_WITH_RELATIONS</span>
<span class="kn">from</span> <span class="nn">tastypie.api</span> <span class="kn">import</span> <span class="n">Api</span>
<span class="kn">from</span> <span class="nn">tastypie.authentication</span> <span class="kn">import</span> <span class="n">ApiKeyAuthentication</span>
<span class="kn">from</span> <span class="nn">tastypie.authorization</span> <span class="kn">import</span> <span class="n">Authorization</span><span class="p">,</span> <span class="n">DjangoAuthorization</span>
<span class="kn">from</span> <span class="nn">tastypie.serializers</span> <span class="kn">import</span> <span class="n">Serializer</span>
<span class="kn">from</span> <span class="nn">tastypie.bundle</span> <span class="kn">import</span> <span class="n">Bundle</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">tastypie.exceptions</span> <span class="kn">import</span> <span class="n">NotFound</span><span class="p">,</span> <span class="n">BadRequest</span><span class="p">,</span> <span class="n">Unauthorized</span>
<span class="kn">from</span> <span class="nn">tastypie.http</span> <span class="kn">import</span> <span class="n">HttpCreated</span>
<span class="kn">from</span> <span class="nn">tastypie.throttle</span> <span class="kn">import</span> <span class="n">CacheDBThrottle</span>

<span class="kn">from</span> <span class="nn">esmond.api</span> <span class="kn">import</span> <span class="n">SNMP_NAMESPACE</span><span class="p">,</span> <span class="n">ANON_LIMIT</span><span class="p">,</span> <span class="n">OIDSET_INTERFACE_ENDPOINTS</span>
<span class="kn">from</span> <span class="nn">esmond.api.auth</span> <span class="kn">import</span> <span class="n">EsmondAuthorization</span><span class="p">,</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">,</span> \
    <span class="n">AnonymousBulkLimitElseApiAuthentication</span><span class="p">,</span> <span class="n">AnonymousTimeseriesBulkLimitElseApiAuthentication</span><span class="p">,</span> \
    <span class="n">AnonymousThrottle</span>
<span class="kn">from</span> <span class="nn">esmond.api.dataseries</span> <span class="kn">import</span> <span class="n">QueryUtil</span><span class="p">,</span> <span class="n">Fill</span>
<span class="kn">from</span> <span class="nn">esmond.api.models</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">IfRef</span><span class="p">,</span> <span class="n">DeviceOIDSetMap</span><span class="p">,</span> <span class="n">OIDSet</span><span class="p">,</span> <span class="n">OID</span><span class="p">,</span> <span class="n">OutletRef</span>
<span class="kn">from</span> <span class="nn">esmond.cassandra</span> <span class="kn">import</span> <span class="n">CASSANDRA_DB</span><span class="p">,</span> <span class="n">AGG_TYPES</span><span class="p">,</span> <span class="n">ConnectionException</span><span class="p">,</span> <span class="n">RawRateData</span><span class="p">,</span> <span class="n">BaseRateBin</span>
<span class="kn">from</span> <span class="nn">esmond.config</span> <span class="kn">import</span> <span class="n">get_config_path</span><span class="p">,</span> <span class="n">get_config</span>
<span class="kn">from</span> <span class="nn">esmond.util</span> <span class="kn">import</span> <span class="n">atdecode</span><span class="p">,</span> <span class="n">atencode</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">CASSANDRA_DB</span><span class="p">(</span><span class="n">get_config</span><span class="p">(</span><span class="n">get_config_path</span><span class="p">()))</span>
<span class="k">except</span> <span class="n">ConnectionException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># Check the stack before raising an error - if test_api is </span>
    <span class="c"># the calling code, we won&#39;t need a running db instance.</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">mod</span> <span class="ow">and</span> <span class="n">mod</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;api.tests.test_api&#39;</span> <span class="ow">or</span> <span class="s">&#39;sphinx.ext.autodoc&#39;</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Unable to connect - presuming stand-alone testing mode...&#39;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ConnectionException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="n">snmp_ns_doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">REST namespace documentation:</span>

<span class="s">**/v1/device/** - Namespace to retrieve traffic data with a simplfied helper syntax.</span>

<span class="s">/v1/device/</span>
<span class="s">/v1/device/$DEVICE/</span>
<span class="s">/v1/device/$DEVICE/interface/</span>
<span class="s">/v1/device/$DEVICE/interface/$INTERFACE/</span>
<span class="s">/v1/device/$DEVICE/interface/$INTERFACE/in</span>
<span class="s">/v1/device/$DEVICE/interface/$INTERFACE/out</span>

<span class="s">Params for GET: begin, end, agg (and cf where appropriate).</span>

<span class="s">If none are supplied, sane defaults will be set by the interface and the </span>
<span class="s">last hour of base rates will be returned.  The begin/end params are </span>
<span class="s">timestamps in seconds, the agg param is the frequency of the aggregation </span>
<span class="s">that the client is requesting, and the cf is one of average/min/max.</span>

<span class="s">This namespace is &#39;browsable&#39; - /v1/device/ will return a list of devices, </span>
<span class="s">/v1/device/$DEVICE/interface/ will return the interfaces on a device, etc. </span>
<span class="s">A full &#39;detail&#39; URI with a defined endpoing data set (as outlined in the </span>
<span class="s">OIDSET_INTERFACE_ENDPOINTS just below) will return the data.</span>

<span class="s">**/v1/oidset/** - Namespace to retrive a list of valid oidsets.</span>

<span class="s">This endpoint is not &#39;browsable&#39; and it takes no GET arguments.  It merely </span>
<span class="s">return a list of valid oidsets from the metadata database for user </span>
<span class="s">reference.</span>

<span class="s">**/v1/interface/** - Namespace to retrieve information about discrete interfaces </span>
<span class="s">without having to &quot;go through&quot; information about a specific device.</span>

<span class="s">This endpoint is not &#39;browsable.&#39;  It takes common GET arguments that </span>
<span class="s">would apply like begin and end to filter active interfaces.  Additionally, </span>
<span class="s">standard django filtering arguments can be applied to the ifDesc and </span>
<span class="s">ifAlias fields (ex: &amp;ifAlias__contains=intercloud) to get information </span>
<span class="s">about specifc subsets of interfaces.</span>

<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="get_throttle_args"><a class="viewcode-back" href="../../api.html#api.api.get_throttle_args">[docs]</a><span class="k">def</span> <span class="nf">get_throttle_args</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;throttle_at&#39;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">api_throttle_at</span><span class="p">,</span>
        <span class="s">&#39;timeframe&#39;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">api_throttle_timeframe</span><span class="p">,</span>
        <span class="s">&#39;expiration&#39;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">api_throttle_expiration</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">args</span>
</div>
<span class="n">THROTTLE_ARGS</span> <span class="o">=</span> <span class="n">get_throttle_args</span><span class="p">(</span><span class="n">get_config</span><span class="p">(</span><span class="n">get_config_path</span><span class="p">()))</span>

<div class="viewcode-block" id="check_connection"><a class="viewcode-back" href="../../api.html#api.api.check_connection">[docs]</a><span class="k">def</span> <span class="nf">check_connection</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Called by testing suite to produce consistent errors.  If no </span>
<span class="sd">    cassandra instance is available, test_api might silently hide that </span>
<span class="sd">    fact with mock.patch causing unclear errors in other modules </span>
<span class="sd">    like test_persist.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">db</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">CASSANDRA_DB</span><span class="p">(</span><span class="n">get_config</span><span class="p">(</span><span class="n">get_config_path</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="build_time_filters"><a class="viewcode-back" href="../../api.html#api.api.build_time_filters">[docs]</a><span class="k">def</span> <span class="nf">build_time_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">orm_filters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build default time filters.</span>

<span class="sd">    By default we want only currently active items.  This will inspect</span>
<span class="sd">    orm_filters and fill in defaults if they are missing.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s">&#39;begin&#39;</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s">&#39;end_time__gte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">])),</span> <span class="n">utc</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s">&#39;begin_time__lte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">])),</span> <span class="n">utc</span><span class="p">)</span>

    <span class="n">filter_keys</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;__&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orm_filters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">django_now</span><span class="p">()</span>

    <span class="k">if</span> <span class="s">&#39;begin_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filter_keys</span><span class="p">:</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s">&#39;begin_time__lte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>

    <span class="k">if</span> <span class="s">&#39;end_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filter_keys</span><span class="p">:</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s">&#39;end_time__gte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">now</span>

    <span class="k">return</span> <span class="n">orm_filters</span>

</div>
<div class="viewcode-block" id="DeviceSerializer"><a class="viewcode-back" href="../../api.html#api.api.DeviceSerializer">[docs]</a><span class="k">class</span> <span class="nc">DeviceSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
<div class="viewcode-block" id="DeviceSerializer.to_json"><a class="viewcode-back" href="../../api.html#api.api.DeviceSerializer.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_simple</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;objects&#39;</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DeviceResource"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource">[docs]</a><span class="k">class</span> <span class="nc">DeviceResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Root resource of this REST schema.  This will return device information </span>
<span class="sd">    form using the ORM and dispatch requests for interface and endpoint </span>
<span class="sd">    information to the appropriate InterfaceResource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">()</span>
    <span class="n">leaf</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">oidsets</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="s">&#39;esmond.api.api.OidsetResource&#39;</span><span class="p">,</span> <span class="s">&#39;oidsets&#39;</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="DeviceResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Device</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;device&#39;</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;community&#39;</span><span class="p">,]</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;put&#39;</span><span class="p">]</span>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;name&#39;</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">DjangoAuthorization</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DeviceResource.dehydrate_begin_time"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dehydrate_begin_time">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_begin_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="c"># return int(time.mktime(bundle.data[&#39;begin_time&#39;].timetuple()))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="DeviceResource.dehydrate_end_time"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dehydrate_end_time">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="c"># return int(time.mktime(bundle.data[&#39;end_time&#39;].timetuple()))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="DeviceResource.hydrate_end_time"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.hydrate_end_time">[docs]</a>    <span class="k">def</span> <span class="nf">hydrate_end_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="c"># The integer timestamp as previously dehydrated needs to </span>
        <span class="c"># be coerced back to a date string or the dateutil parser will</span>
        <span class="c"># barf.</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PUT&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end_time&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end_time&#39;</span><span class="p">]),</span> <span class="n">utc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="DeviceResource.hydrate_begin_time"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.hydrate_begin_time">[docs]</a>    <span class="k">def</span> <span class="nf">hydrate_begin_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="c"># See hydrate_end_time comment.</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PUT&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin_time&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_aware</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span>
                <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin_time&#39;</span><span class="p">]),</span> <span class="n">utc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="DeviceResource.hydrate_oidsets"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.hydrate_oidsets">[docs]</a>    <span class="k">def</span> <span class="nf">hydrate_oidsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oidsets&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oidsets&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">bundle</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oidsets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OIDSet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__in</span><span class="o">=</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;oidsets&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="DeviceResource.save_m2m"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.save_m2m">[docs]</a>    <span class="k">def</span> <span class="nf">save_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>

        <span class="n">device</span> <span class="o">=</span> <span class="n">Device</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oidsets&#39;</span><span class="p">]:</span>
            <span class="n">omap</span> <span class="o">=</span> <span class="n">DeviceOIDSetMap</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">oid_set</span><span class="o">=</span><span class="n">o</span><span class="p">)</span>
            <span class="n">omap</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="DeviceResource.alter_detail_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.alter_detail_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_detail_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;resource_uri&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="DeviceResource.prepend_urls"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.prepend_urls">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        URL regex parsing for this REST schema.  The call to dispatch_detail </span>
<span class="sd">        returns Device information the ORM, the other calls are dispatched to </span>
<span class="sd">        the methods below.  </span>

<span class="sd">        This is connected to the django url schema by the call:</span>

<span class="sd">        v1_api = Api(api_name=&#39;v1&#39;)</span>
<span class="sd">        v1_api.register(DeviceResource())</span>

<span class="sd">        at the bottom of the module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/$&quot;</span> \
                <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/interface/?$&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_interface_list&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/interface/(?P&lt;iface_name&gt;[\w\d_.\-@]+)/?$&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_interface_detail&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/interface/(?P&lt;iface_name&gt;[\w\d_.\-@]+)/(?P&lt;iface_dataset&gt;[\w\d_.-/]+)/?$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_interface_data&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
                <span class="p">]</span>
</div>
<div class="viewcode-block" id="DeviceResource.build_filters"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.build_filters">[docs]</a>    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DeviceResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="n">build_time_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">orm_filters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">orm_filters</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The three following methods are invoked by the prepend_urls regex parsing. </span>
<span class="sd">    They invoke and return an the appropriate method call on an instance of </span>
<span class="sd">    one of the Interface* resorces below.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DeviceResource.dispatch_interface_list"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dispatch_interface_list">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_interface_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">InterfaceResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
                <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DeviceResource.dispatch_interface_detail"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dispatch_interface_detail">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_interface_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">InterfaceResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
                <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">ifDescr</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">]</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="DeviceResource.dispatch_interface_data"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dispatch_interface_data">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_interface_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">InterfaceDataResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DeviceResource.dehydrate_children"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dehydrate_children">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;interface&#39;</span><span class="p">,</span> <span class="s">&#39;system&#39;</span><span class="p">,</span> <span class="s">&#39;all&#39;</span><span class="p">]</span>

        <span class="n">base_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">leaf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">children</span> <span class="p">]</span>
</div>
<div class="viewcode-block" id="DeviceResource.dehydrate"><a class="viewcode-back" href="../../api.html#api.api.DeviceResource.dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;leaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">bundle</span>

</div></div>
<div class="viewcode-block" id="OidsetResource"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource">[docs]</a><span class="k">class</span> <span class="nc">OidsetResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
<div class="viewcode-block" id="OidsetResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;oidset&#39;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">OIDSet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;poller_args&#39;</span><span class="p">,</span> <span class="s">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="c"># This one doesn&#39;t really need to be throttled.</span>
</div>
<div class="viewcode-block" id="OidsetResource.get_object_list"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span>
</div>
<div class="viewcode-block" id="OidsetResource.obj_get_list"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OidsetResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OidsetResource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="OidsetResource.dehydrate"><a class="viewcode-back" href="../../api.html#api.api.OidsetResource.dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="OidsetEndpointResource"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource">[docs]</a><span class="k">class</span> <span class="nc">OidsetEndpointResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">oids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="s">&#39;esmond.api.api.OidResource&#39;</span><span class="p">,</span> <span class="s">&#39;oids&#39;</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="OidsetEndpointResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;oidsetmap&#39;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">OIDSet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;poller_args&#39;</span><span class="p">,</span> <span class="s">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="n">include_resource_uri</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="OidsetEndpointResource.get_object_list"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span>
</div>
<div class="viewcode-block" id="OidsetEndpointResource.obj_get_list"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OidsetEndpointResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OidsetEndpointResource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">oidset</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">oidset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oids&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;endpoint_alias&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">oidset</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">payload</span><span class="p">[</span><span class="n">oidset</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">payload</span><span class="p">[</span><span class="n">oidset</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;endpoint_alias&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">payload</span>
</div>
<div class="viewcode-block" id="OidsetEndpointResource.dehydrate"><a class="viewcode-back" href="../../api.html#api.api.OidsetEndpointResource.dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;oids&#39;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;aggregate&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">oid</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;resource_uri&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div></div>
<div class="viewcode-block" id="OidResource"><a class="viewcode-back" href="../../api.html#api.api.OidResource">[docs]</a><span class="k">class</span> <span class="nc">OidResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
<div class="viewcode-block" id="OidResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.OidResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;oid&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">OID</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OidResource.get_object_list"><a class="viewcode-back" href="../../api.html#api.api.OidResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span>
</div>
<div class="viewcode-block" id="OidResource.obj_get_list"><a class="viewcode-back" href="../../api.html#api.api.OidResource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OidResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="InterfaceResource"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource">[docs]</a><span class="k">class</span> <span class="nc">InterfaceResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An interface on a device.</span>

<span class="sd">    Note: this resource is always nested under a DeviceResource and is not bound</span>
<span class="sd">    into the normal namespace for the API.&quot;&quot;&quot;</span>

    <span class="n">device</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToOneField</span><span class="p">(</span><span class="n">DeviceResource</span><span class="p">,</span> <span class="s">&#39;device&#39;</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">()</span>
    <span class="n">leaf</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">device_uri</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

<div class="viewcode-block" id="InterfaceResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;interface&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">IfRef</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;ifDescr&#39;</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;device&#39;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
            <span class="s">&#39;ifDescr&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
            <span class="s">&#39;ifAlias&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceResource.obj_get"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The standard time range filtering is applied to obj_get since there may</span>
<span class="sd">        actually be more than one underlying IfRef for this interface. If there</span>
<span class="sd">        is more than one IfRef during the selected time period the IfRef with</span>
<span class="sd">        the greatest end_time is returned.</span>

<span class="sd">        This also massages the incoming URL fragment to restore characters in </span>
<span class="sd">        ifDescr which were encoded to avoid URL metacharacters back to</span>
<span class="sd">        their original state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ifDescr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atdecode</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ifDescr&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">build_time_filters</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_list</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-end_time&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">InterfaceResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceResource.get_object_list"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">&quot;api.can_see_hidden_ifref&quot;</span><span class="p">):</span>
            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">ifAlias__contains</span><span class="o">=</span><span class="s">&quot;:hide:&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qs</span>
</div>
<div class="viewcode-block" id="InterfaceResource.obj_get_list"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.obj_get_list">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">InterfaceResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceResource.build_filters"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.build_filters">[docs]</a>    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InterfaceResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="n">build_time_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">orm_filters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">orm_filters</span>
</div>
<div class="viewcode-block" id="InterfaceResource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify resource object default format before this is returned </span>
<span class="sd">        and serialized as json.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;children&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="InterfaceResource.get_resource_uri"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the resource uri element that is returned in json payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span>

        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">DeviceResource</span><span class="p">()</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                <span class="s">&#39;interface/&#39;</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">encoded_ifDescr</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">uri</span>
</div>
<div class="viewcode-block" id="InterfaceResource.dehydrate_children"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.dehydrate_children">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">oidset</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">oidset</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">[</span><span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">base_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">leaf</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">children</span> <span class="p">]</span>
</div>
<div class="viewcode-block" id="InterfaceResource.dehydrate"><a class="viewcode-back" href="../../api.html#api.api.InterfaceResource.dehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;leaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;resource_uri&#39;</span><span class="p">]</span>
        <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;device_uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div></div>
<div class="viewcode-block" id="DataObject"><a class="viewcode-back" href="../../api.html#api.api.DataObject">[docs]</a><span class="k">class</span> <span class="nc">DataObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulation object to assign values to during processing.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="s">&#39;items&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_data&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="DataObject.to_dict"><a class="viewcode-back" href="../../api.html#api.api.DataObject.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</div></div>
<div class="viewcode-block" id="InterfaceDataObject"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataObject">[docs]</a><span class="k">class</span> <span class="nc">InterfaceDataObject</span><span class="p">(</span><span class="n">DataObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulation object to assign values to during processing.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="InterfaceDataResource"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataResource">[docs]</a><span class="k">class</span> <span class="nc">InterfaceDataResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data for interface on a device.</span>

<span class="sd">    Note: this resource is always nested under a DeviceResource and is not bound</span>
<span class="sd">    into the normal namespace for the API.&quot;&quot;&quot;</span>

    <span class="n">begin_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;begin_time&#39;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;end_time&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;agg&#39;</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;cf&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="InterfaceDataResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;interface_data&#39;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">object_class</span> <span class="o">=</span> <span class="n">InterfaceDataObject</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceDataResource.get_object_list"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataResource.get_object_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">_clone</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">begin_time__gte</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">end_time__lt</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceDataResource.get_resource_uri"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataResource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate resource uri&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">InterfaceResource</span><span class="p">()</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">iface</span><span class="p">),</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">iface_dataset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uri</span>
</div>
<div class="viewcode-block" id="InterfaceDataResource.obj_get"><a class="viewcode-back" href="../../api.html#api.api.InterfaceDataResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invoked when the actual data detail is requested.  Checks the </span>
<span class="sd">        interface name, and generates the endpoint mapping which contains </span>
<span class="sd">        the array &#39;path&#39; that is used to request the data from the backend.</span>

<span class="sd">        If that is all good, then query args are parsed, defaults are set if </span>
<span class="sd">        none were supplied and then the query is executed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atdecode</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">iface</span> <span class="o">=</span> <span class="n">InterfaceResource</span><span class="p">()</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span>
                    <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                    <span class="n">ifDescr</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">IfRef</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;no such device/interface: dev: {0} int: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">]))</span>

        <span class="n">oidsets</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">endpoint_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">oidset</span> <span class="ow">in</span> <span class="n">oidsets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oidset</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">varname</span> <span class="ow">in</span> \
                    <span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">[</span><span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">endpoint_map</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">SNMP_NAMESPACE</span><span class="p">,</span>
                    <span class="n">iface</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">varname</span><span class="p">,</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_name&#39;</span><span class="p">]</span>
                <span class="p">]</span>

        <span class="n">iface_dataset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface_dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">iface_dataset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">endpoint_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;no such dataset: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">iface_dataset</span><span class="p">)</span>

        <span class="n">oidset</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">endpoint_map</span><span class="p">[</span><span class="n">iface_dataset</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">InterfaceDataObject</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">endpoint_map</span><span class="p">[</span><span class="n">iface_dataset</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">oidset</span><span class="o">.</span><span class="n">set_name</span>  <span class="c"># set_name defaults to oidset.name, but can be overidden in poller_args</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">iface_dataset</span> <span class="o">=</span> <span class="n">iface_dataset</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c"># Make sure incoming begin/end timestamps are ints</span>
        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;cf&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s">&#39;cf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;average&#39;</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;agg&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;agg&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">oidset</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidset</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes a couple of reality checks (making sure that a valid </span>
<span class="sd">        aggregation was requested and checks/limits the time range), and</span>
<span class="sd">        then make calls to cassandra backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># If no aggregate level defined in request, set to the frequency, </span>
        <span class="c"># otherwise, check if the requested aggregate level is valid.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="n">oidset</span><span class="o">.</span><span class="n">frequency</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">oidset</span><span class="o">.</span><span class="n">aggregates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;there are no aggregations for oidset {0} - {1} was requested&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oidset</span><span class="o">.</span><span class="n">aggregates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;no valid aggregation </span><span class="si">%s</span><span class="s"> in oidset </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span> <span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="c"># Make sure we&#39;re not exceeding allowable time range.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">valid_timerange</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;exceeded valid timerange for agg level: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>
        
        <span class="c"># db = CASSANDRA_DB(get_config(get_config_path()))</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">==</span> <span class="n">oidset</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="c"># Fetch the base rate data.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_baserate_timerange</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
                    <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Get the aggregation.</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">AGG_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not a valid consolidation function&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cf</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_aggregation_timerange</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
                    <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cf</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">cf</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">format_data_payload</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Fill</span><span class="o">.</span><span class="n">verify_fill</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>

<span class="c"># ---</span>
</div>
<span class="n">bulk_ns_doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">**/v1/bulk/** - Not a true namespace.  The /bulk/ ns node will dispatch URIs</span>
<span class="s">like /bulk/interface/ or /bulk/timeseries/ to the appropriate classes.</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BulkDispatch"><a class="viewcode-back" href="../../api.html#api.api.BulkDispatch">[docs]</a><span class="k">class</span> <span class="nc">BulkDispatch</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to dispatch the /v1/bulk namespace to other bulk resources.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BulkDispatch.Meta"><a class="viewcode-back" href="../../api.html#api.api.BulkDispatch.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;bulk&#39;</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">]</span>
        <span class="c"># This just dispatches, so let the actual resources work it out.</span>
        <span class="c"># authentication = AnonymousGetElseApiAuthentication()</span>
</div>
<div class="viewcode-block" id="BulkDispatch.prepend_urls"><a class="viewcode-back" href="../../api.html#api.api.BulkDispatch.prepend_urls">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_namespace_root&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;r_type&gt;[\w\d_.-]+)/$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_query_type&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>
</div>
<div class="viewcode-block" id="BulkDispatch.dispatch_namespace_root"><a class="viewcode-back" href="../../api.html#api.api.BulkDispatch.dispatch_namespace_root">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_namespace_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Incomplete path: /v1/bulk/&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must supply bulk node: /v1/bulk/{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">QueryUtil</span><span class="o">.</span><span class="n">bulk_request_types</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="BulkDispatch.dispatch_query_type"><a class="viewcode-back" href="../../api.html#api.api.BulkDispatch.dispatch_query_type">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_query_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">r_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r_type&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;timeseries&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TimeseriesBulkRequestResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;interface&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InterfaceBulkRequestResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Bulk node must be one of the following: /v1/bulk/{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">QueryUtil</span><span class="o">.</span><span class="n">bulk_request_types</span><span class="p">)))</span>
</div></div>
<span class="n">bulk_interface_ns_doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">**/v1/bulk/interface/** - Namespace to retrive bulk traffic data from </span>
<span class="s">multiple interfaces without needing to make multiple round trip http </span>
<span class="s">requests via the main device/interface/endpoint namespace documented </span>
<span class="s">at the top of the module.</span>

<span class="s">This namespace is not &#39;browsable,&#39; and while it runs counter to typical </span>
<span class="s">REST semantics/verbs, it implements the POST verb.  This is to get around </span>
<span class="s">potential limitations in how many arguments/length of said that can be </span>
<span class="s">sent in a GET request.  The request information is sent as a json blob:</span>

<span class="s">{ </span>
<span class="s">    &#39;interfaces&#39;: [{&#39;interface&#39;: me0.0, &#39;device&#39;: albq-asw1}, ...], </span>
<span class="s">    &#39;endpoint&#39;: [&#39;in&#39;, &#39;out&#39;],</span>
<span class="s">    &#39;cf&#39;: &#39;average&#39;,</span>
<span class="s">    &#39;begin&#39;: 1382459647,</span>
<span class="s">    &#39;end&#39;: 1382463247,</span>
<span class="s">}</span>

<span class="s">Interfaces are requestes as a list of dicts containing iface and device </span>
<span class="s">information.  Different kinds of endpoints (in, out, error/in, </span>
<span class="s">discard/out, etc) are passed in as a list and data for each sort of </span>
<span class="s">endpoint will be returned for each interface.</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceBulkRequestDataObject"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestDataObject">[docs]</a><span class="k">class</span> <span class="nc">InterfaceBulkRequestDataObject</span><span class="p">(</span><span class="n">DataObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data encapsulation.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="InterfaceBulkRequestResource"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestResource">[docs]</a><span class="k">class</span> <span class="nc">InterfaceBulkRequestResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource to make a series of requests to the cassandra backend</span>
<span class="sd">    to avoid a bunch of round trip http requests to the REST interface.</span>
<span class="sd">    Takes a POST verb to get around around limitations in passing </span>
<span class="sd">    lots of args to GET requests.  Incoming payload looks like this:</span>

<span class="sd">    {</span>
<span class="sd">        &#39;interfaces&#39;: [{&#39;interface&#39;: me0.0, &#39;device&#39;: albq-asw1}, ...],</span>
<span class="sd">        &#39;endpoint&#39;: &#39;in&#39;,</span>
<span class="sd">        other usual args (begin/end/cf...)</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceBulkRequestResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;bulkinterface&#39;</span> <span class="c"># handled by BulkDispatch.</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">]</span>
        <span class="n">always_return_data</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">object_class</span> <span class="o">=</span> <span class="n">InterfaceBulkRequestDataObject</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousBulkLimitElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterfaceBulkRequestResource.obj_create"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestResource.obj_create">[docs]</a>    <span class="k">def</span> <span class="nf">obj_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;application/json&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must post content-type: application/json header and json-formatted payload.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;No data payload POSTed.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;interfaces&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> \
            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;endpoint&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Payload must contain keys interfaces and endpoint.&#39;</span><span class="p">)</span>

        <span class="n">ret_obj</span> <span class="o">=</span> <span class="n">InterfaceBulkRequestDataObject</span><span class="p">()</span>
        <span class="n">ret_obj</span><span class="o">.</span><span class="n">iface_dataset</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;endpoint&#39;</span><span class="p">]</span>
        <span class="n">ret_obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ret_obj</span><span class="o">.</span><span class="n">device_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Set up filtering and return values</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;cf&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;cf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;average&#39;</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;agg&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;agg&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;interfaces&#39;</span><span class="p">]:</span>
            <span class="n">device_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">iface_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s">&#39;iface&#39;</span><span class="p">]</span>

            <span class="n">ret_obj</span><span class="o">.</span><span class="n">device_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">end_point</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;endpoint&#39;</span><span class="p">]:</span>
                <span class="c"># print device_name, iface_name, end_point</span>
                <span class="n">endpoint_map</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">Device</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">device_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">oidset</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">oidset</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">varname</span> <span class="ow">in</span> \
                        <span class="n">OIDSET_INTERFACE_ENDPOINTS</span><span class="o">.</span><span class="n">endpoints</span><span class="p">[</span><span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="n">endpoint_map</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">SNMP_NAMESPACE</span><span class="p">,</span>
                            <span class="n">device_name</span><span class="p">,</span>
                            <span class="n">oidset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">varname</span><span class="p">,</span>
                            <span class="n">iface_name</span>
                        <span class="p">]</span>

                <span class="k">if</span> <span class="n">end_point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">endpoint_map</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;no such dataset: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">end_point</span><span class="p">)</span>

                <span class="n">oidset</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">endpoint_map</span><span class="p">[</span><span class="n">end_point</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

                <span class="n">obj</span> <span class="o">=</span> <span class="n">InterfaceBulkRequestDataObject</span><span class="p">()</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">endpoint_map</span><span class="p">[</span><span class="n">end_point</span><span class="p">]</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">iface_dataset</span> <span class="o">=</span> <span class="n">end_point</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface_name</span>

                <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">agg</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">InterfaceDataResource</span><span class="p">()</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">oidset</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

                <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                    <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;dev&#39;</span><span class="p">:</span> <span class="n">device_name</span><span class="p">,</span><span class="s">&#39;iface&#39;</span><span class="p">:</span> <span class="n">iface_name</span><span class="p">,</span><span class="s">&#39;endpoint&#39;</span><span class="p">:</span> <span class="n">end_point</span><span class="p">},</span>
                <span class="p">}</span>

                <span class="n">ret_obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">ret_obj</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="InterfaceBulkRequestResource.alter_detail_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestResource.alter_detail_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_detail_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="InterfaceBulkRequestResource.detail_uri_kwargs"><a class="viewcode-back" href="../../api.html#api.api.InterfaceBulkRequestResource.detail_uri_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">detail_uri_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">kwargs</span>

<span class="c"># ---</span>
</div></div>
<span class="n">ts_ns_doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">**/v1/timeseries/** - Namespace to retrive data with explicit Cassandra </span>
<span class="s">schema-like syntax.</span>

<span class="s">/v1/timeseries/</span>
<span class="s">/v1/timeseries/$TYPE/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/$DEVICE/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/$DEVICE/$OIDSET/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/$DEVICE/$OIDSET/$OID/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/$DEVICE/$OIDSET/$OID/$INTERFACE/</span>
<span class="s">/v1/timeseries/$TYPE/$NS/$DEVICE/$OIDSET/$OID/$INTERFACE/$FREQUENCY</span>

<span class="s">$TYPE: is RawData, BaseRate or Aggs</span>
<span class="s">$NS: is just a prefix/key construct</span>

<span class="s">Params for get: begin, end, and cf where appropriate.</span>
<span class="s">Params for put: JSON list of dicts with keys &#39;val&#39; and &#39;ts&#39; sent as POST </span>
<span class="s">data payload.</span>

<span class="s">GET: The begin/end params are timestamps in milliseconds, and the cf is </span>
<span class="s">one of average/min/max.  If none are given, begin/end will default to the </span>
<span class="s">last hour.</span>

<span class="s">In short: everything after the /v1/timeseries/$TYPE/ segment of the URI is </span>
<span class="s">joined together to create a cassandra row key.  The path must end with a </span>
<span class="s">valid numeric frequency.  The URIs could potentailly be longer or shorter </span>
<span class="s">depending on the composition of the row keys of the data being retrieved </span>
<span class="s">or written - this is just based on the composition of the snmp data keys.</span>

<span class="s">The $NS element is just a construct of how we are storing the data.  It is </span>
<span class="s">just a prefix - the esmond data is being stored with the previx snmp for </span>
<span class="s">example.  Ultimately it is still just part of the generated path.</span>

<span class="s">This namespace is not &#39;browsable&#39; - GET and POST requests expect expect a </span>
<span class="s">full &#39;detail&#39; URI.  Entering an incomplete URI (ex: /v1/timeseries/, etc) </span>
<span class="s">will result in a 400 error being returned.</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TimeseriesDataObject"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesDataObject">[docs]</a><span class="k">class</span> <span class="nc">TimeseriesDataObject</span><span class="p">(</span><span class="n">DataObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data encapsulation.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TimeseriesResource"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource">[docs]</a><span class="k">class</span> <span class="nc">TimeseriesResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a non-ORM resource.  The fields defined right below </span>
<span class="sd">    are just the return values from ths resource, not connected to </span>
<span class="sd">    a database backend.</span>

<span class="sd">    This accepts both GET and POST requests.  The POST is dispatched </span>
<span class="sd">    to post_detail and not create_obj since this is using the full </span>
<span class="sd">    &#39;detail&#39; level URI during the request to define the complete cassandra</span>
<span class="sd">    key.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">begin_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;begin_time&#39;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;end_time&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;agg&#39;</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;cf&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TimeseriesResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;timeseries&#39;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">]</span> <span class="c"># see post_detail comment</span>
        <span class="n">object_class</span> <span class="o">=</span> <span class="n">TimeseriesDataObject</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">EsmondAuthorization</span><span class="p">(</span><span class="s">&#39;timeseries&#39;</span><span class="p">)</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.prepend_urls"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.prepend_urls">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        URL parsing - most of these patterns just match an imcomplete </span>
<span class="sd">        URL and dispatch them to methods that return an appropriate</span>
<span class="sd">        error message.  The final pattern passes a request to an actual </span>
<span class="sd">        processing method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_namespace_root&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;r_type&gt;[\w\d_.-]+)/$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_data_type&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;r_type&gt;[\w\d_.-]+)/(?P&lt;ns&gt;[\w\d_.-]+)/$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_data_ns&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;r_type&gt;[\w\d_.-]+)/(?P&lt;ns&gt;[\w\d_.-]+)/(?P&lt;path&gt;.+)$&quot;</span> <span class="o">%</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
        <span class="p">]</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.dispatch_namespace_root"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.dispatch_namespace_root">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_namespace_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Incomplete path: /v1/timeseries/&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must supply data type {0}, namespace and path.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">QueryUtil</span><span class="o">.</span><span class="n">timeseries_request_types</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.dispatch_data_type"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.dispatch_data_type">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Incomplete path: /v1/timeseries/$TYPE/&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must supply namespace and path for type {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r_type&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.dispatch_data_ns"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.dispatch_data_ns">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_data_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Incomplete path: /v1/timeseries/$TYPE/$NS/ &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must supply path for namespace {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ns&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.get_resource_uri"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate resource_uri for json payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">encode_datapath</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="s">&#39;/{0}/{1}/{2}/{3}/{4}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> 
            <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">),</span> <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uri</span>
</div>
<div class="viewcode-block" id="TimeseriesResource.obj_get"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invoked when a GET request hits this namespace.  Sanity check incoming</span>
<span class="sd">        URI segment/args, sets defaults if need be and executes the query.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TimeseriesDataObject</span><span class="p">()</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r_type&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ns&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">decode_datapath</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c"># Change this to a 404?</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Last segment of URI must be frequency integer.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">timeseries_request_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Request type must be one of {0} - {1} was given.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">QueryUtil</span><span class="o">.</span><span class="n">timeseries_request_types</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span><span class="p">))</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;cf&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s">&#39;cf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;RawData&#39;</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;raw&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;average&#39;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>
</div>
    <span class="k">def</span> <span class="nf">_check_post_detail_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">TimeseriesDataObject</span><span class="p">()</span>
        <span class="n">o</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">EsmondAuthorization</span><span class="p">(</span><span class="s">&#39;timeseries&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create_detail</span><span class="p">([],</span> <span class="n">o</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Unauthorized</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unauthorized_result</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="TimeseriesResource.post_detail"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesResource.post_detail">[docs]</a>    <span class="k">def</span> <span class="nf">post_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invoked when a POST request is issued.  Rather than CGI-style </span>
<span class="sd">        http parameters, a JSON blob (a list of dicts) is passed in as </span>
<span class="sd">        the the body of the request.</span>

<span class="sd">        This performs some rather granular sanity checks on the incoming </span>
<span class="sd">        request/JSON payload.  If that passes, then a list of data objects </span>
<span class="sd">        is generated from the payload and passed to the method that </span>
<span class="sd">        executes the inserts.</span>

<span class="sd">        When debating the PUT/POST issue on how to handle this,</span>
<span class="sd">        I read a comment about the issue that theoretically a </span>
<span class="sd">        PUT command should be idempotent and not all of our</span>
<span class="sd">        cassandra writes are (base rates for example) so post </span>
<span class="sd">        was chosen. -MMG</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check auth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_post_detail_auth</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c"># Validate incoming POST/JSON payload:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;application/json&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must post content-type: application/json header and json-formatted payload.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;No data payload POSTed.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;POST data payload could not be decoded to a JSON object - given: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">body</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Successfully decoded JSON, but expecting a list - got: {0} from input: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">input_payload</span><span class="p">),</span> <span class="n">input_payload</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">input_payload</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Expecting a JSON formtted list of dicts - contained {0} as an array element.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ts&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Expecting list of dicts with keys </span><span class="se">\&#39;</span><span class="s">val</span><span class="se">\&#39;</span><span class="s"> and </span><span class="se">\&#39;</span><span class="s">ts</span><span class="se">\&#39;</span><span class="s"> - got: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ts&#39;</span><span class="p">)))</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must supply valid numeric args for ts and val dict attributes - got: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>


        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">input_payload</span><span class="p">:</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="n">TimeseriesDataObject</span><span class="p">()</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;r_type&#39;</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ns&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ts&#39;</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;val&#39;</span><span class="p">)</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">decode_datapath</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">timeseries_request_types</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Request type must be one of {0} - {1} was given.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">QueryUtil</span><span class="o">.</span><span class="n">timeseries_request_types</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span><span class="p">))</span>

            <span class="c"># Currently only doing raw and base.</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="s">&#39;RawData&#39;</span><span class="p">,</span> <span class="s">&#39;BaseRate&#39;</span> <span class="p">]:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Only POSTing RawData or BaseRate currently supported.&#39;</span><span class="p">)</span>

            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_inserts</span><span class="p">(</span><span class="n">objs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">HttpCreated</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Error TBA</span>
            <span class="k">pass</span>
</div>
    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanity check the requested timerange, and then make the appropriate</span>
<span class="sd">        method call to the cassandra backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Make sure we&#39;re not exceeding allowable time range.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">valid_timerange</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">in_ms</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;exceeded valid timerange for agg level: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;BaseRate&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_baserate_timerange</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span>
                    <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;Aggs&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">AGG_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not a valid consolidation function&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">cf</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_aggregation_timerange</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span>
                    <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">cf</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">cf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;RawData&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_raw_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span>
                    <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Input has been checked already</span>
            <span class="k">pass</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">format_data_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">in_ms</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="c"># If no data is returned, sanity check that there is a </span>
            <span class="c"># corresponding key in the database.</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">check_for_valid_keys</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span> 
                <span class="n">ts_min</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">ts_max</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;The request path {0} has no corresponding keys.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">r_type</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">+</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">!=</span> <span class="s">&#39;RawData&#39;</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Fill</span><span class="o">.</span><span class="n">verify_fill</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_execute_inserts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through a list of TimeseriesDataObject, execute the </span>
<span class="sd">        appropriate inserts, and then explicitly flush the db so the </span>
<span class="sd">        inserts don&#39;t sit in the batch wating for more data to auto-flush.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;BaseRate&#39;</span><span class="p">:</span>
                <span class="n">rate_bin</span> <span class="o">=</span> <span class="n">BaseRateBin</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> 
                    <span class="n">val</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">update_rate_bin</span><span class="p">(</span><span class="n">rate_bin</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;Aggs&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">==</span> <span class="s">&#39;RawData&#39;</span><span class="p">:</span>
                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">RawRateData</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> 
                    <span class="n">val</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">set_raw_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Input has been checked already</span>
                <span class="k">pass</span>
        
        <span class="n">db</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">True</span>

<span class="c"># ---</span>
</div>
<span class="n">bulk_namespace_ns_doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">**/v1/bulk/timeseries/** - Namespace to retrive bulk traffic data from </span>
<span class="s">multiple paths without needing to make multiple round trip http </span>
<span class="s">requests via the /timeseries/ namespace.</span>

<span class="s">This namespace is not &#39;browsable,&#39; and while it runs counter to typical </span>
<span class="s">REST semantics/verbs, it implements the POST verb.  This is to get around </span>
<span class="s">potential limitations in how many arguments/length of said that can be </span>
<span class="s">sent in a GET request.  The request information is sent as a json blob:</span>

<span class="s">{</span>
<span class="s">    &#39;paths&#39;: [</span>
<span class="s">        [&#39;snmp&#39;, &#39;lbl-mr2&#39;, &#39;FastPollHC&#39;, &#39;ifHCInOctets&#39;, &#39;xe-9/3/0.202&#39;, &#39;30000&#39;], </span>
<span class="s">        [&#39;snmp&#39;, &#39;anl-mr2&#39;, &#39;FastPollHC&#39;, &#39;ifHCOutOctets&#39;, &#39;xe-7/0/0.1808&#39;, &#39;30000&#39;]</span>
<span class="s">    ], </span>
<span class="s">    &#39;begin&#39;: 1384976511773, </span>
<span class="s">    &#39;end&#39;: 1384980111773, </span>
<span class="s">    &#39;type&#39;: &#39;RawData&#39;</span>
<span class="s">}</span>

<span class="s">Data are requested as a list of paths per the /timeseries namespace with</span>
<span class="s">the addition of a frequency (in ms) at the end of the path dict mimicing</span>
<span class="s">the cassandra row keys.</span>
<span class="s">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TimeseriesBulkRequestDataObject"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestDataObject">[docs]</a><span class="k">class</span> <span class="nc">TimeseriesBulkRequestDataObject</span><span class="p">(</span><span class="n">DataObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data encapsulation.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TimeseriesBulkRequestResource"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestResource">[docs]</a><span class="k">class</span> <span class="nc">TimeseriesBulkRequestResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resource to make a series of requests to the cassandra backend</span>
<span class="sd">    to avoid a bunch of round trip http requests to the REST interface.</span>
<span class="sd">    Takes a POST verb to get around around limitations in passing </span>
<span class="sd">    lots of args to GET requests.  Incoming payload looks like this:</span>

<span class="sd">    {</span>
<span class="sd">    &#39;paths&#39;: [</span>
<span class="sd">        [&#39;snmp&#39;, &#39;lbl-mr2&#39;, &#39;FastPollHC&#39;, &#39;ifHCInOctets&#39;, &#39;xe-9/3/0.202&#39;, &#39;30000&#39;], </span>
<span class="sd">        [&#39;snmp&#39;, &#39;anl-mr2&#39;, &#39;FastPollHC&#39;, &#39;ifHCOutOctets&#39;, &#39;xe-7/0/0.1808&#39;, &#39;30000&#39;]</span>
<span class="sd">    ], </span>
<span class="sd">    &#39;begin&#39;: 1384976511773, </span>
<span class="sd">    &#39;end&#39;: 1384980111773, </span>
<span class="sd">    &#39;type&#39;: &#39;RawData&#39;</span>
<span class="sd">    }</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TimeseriesBulkRequestResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;timeseriesbulk&#39;</span> <span class="c"># handled by BulkDispatch</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">]</span>
        <span class="n">always_return_data</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">object_class</span> <span class="o">=</span> <span class="n">TimeseriesBulkRequestDataObject</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousTimeseriesBulkLimitElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TimeseriesBulkRequestResource.obj_create"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestResource.obj_create">[docs]</a>    <span class="k">def</span> <span class="nf">obj_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;application/json&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Must post content-type: application/json header and json-formatted payload.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;No data payload POSTed.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;paths&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> \
            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Payload must contain keys paths and type.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;paths&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&#39;Payload paths element must be a list - got: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;lists&#39;</span><span class="p">]))</span>

        <span class="n">ret_obj</span> <span class="o">=</span> <span class="n">TimeseriesBulkRequestDataObject</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;RawData&#39;</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;raw&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="s">&#39;average&#39;</span>

        <span class="n">ret_obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;paths&#39;</span><span class="p">]:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">TimeseriesBulkRequestDataObject</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">r_type</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">cf</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">begin_time</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">ret_obj</span><span class="o">.</span><span class="n">end_time</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">agg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="n">TimeseriesResource</span><span class="p">()</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">+</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">agg</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="n">ret_obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">ret_obj</span>
        <span class="k">return</span> <span class="n">bundle</span>
</div>
<div class="viewcode-block" id="TimeseriesBulkRequestResource.alter_detail_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestResource.alter_detail_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_detail_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TimeseriesBulkRequestResource.detail_uri_kwargs"><a class="viewcode-back" href="../../api.html#api.api.TimeseriesBulkRequestResource.detail_uri_kwargs">[docs]</a>    <span class="k">def</span> <span class="nf">detail_uri_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">kwargs</span>

<span class="c"># ---</span>
</div></div>
<div class="viewcode-block" id="PDUResource"><a class="viewcode-back" href="../../api.html#api.api.PDUResource">[docs]</a><span class="k">class</span> <span class="nc">PDUResource</span><span class="p">(</span><span class="n">DeviceResource</span><span class="p">):</span>
<div class="viewcode-block" id="PDUResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Device</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="n">OutletRef</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&quot;device__pk&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;pdu&#39;</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">DeviceSerializer</span><span class="p">()</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;community&#39;</span><span class="p">,]</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;name&#39;</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="p">}</span>
</div>
<div class="viewcode-block" id="PDUResource.dehydrate_children"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.dehydrate_children">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;outlet&#39;</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">base_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">leaf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">children</span> <span class="p">]</span>

</div>
<div class="viewcode-block" id="PDUResource.prepend_urls"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.prepend_urls">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        URL regex parsing for this REST schema.  The call to dispatch_detail</span>
<span class="sd">        returns Device information the ORM, the other calls are dispatched to</span>
<span class="sd">        the methods below.</span>

<span class="sd">        This is connected to the django url schema by the call:</span>

<span class="sd">        v1_api = Api(api_name=&#39;v1&#39;)</span>
<span class="sd">        v1_api.register(DeviceResource())</span>

<span class="sd">        at the bottom of the module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/$&quot;</span> \
                <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_detail&#39;</span><span class="p">),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_dispatch_detail&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/outlet/?$&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_outlet_list&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/outlet/(?P&lt;outlet_id&gt;[\w\d_.\-@]+)/?$&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_outlet_detail&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
            <span class="n">url</span><span class="p">(</span><span class="s">r&quot;^(?P&lt;resource_name&gt;</span><span class="si">%s</span><span class="s">)/(?P&lt;name&gt;[\w\d_.-]+)/outlet/(?P&lt;outlet_id&gt;[\w\d_.\-@]+)/(?P&lt;outlet_dataset&gt;[\w\d_.-/]+)/?$&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s">&#39;dispatch_outlet_data&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;api_get_children&quot;</span><span class="p">),</span>
                <span class="p">]</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The three following methods are invoked by the prepend_urls regex parsing. </span>
<span class="sd">    They invoke and return an the appropriate method call on an instance of </span>
<span class="sd">    one of the Interface* resorces below.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PDUResource.dispatch_outlet_list"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.dispatch_outlet_list">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_outlet_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OutletResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
                <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="PDUResource.dispatch_outlet_detail"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.dispatch_outlet_detail">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_outlet_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OutletResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
                <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">outletID</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;outlet_id&#39;</span><span class="p">]</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="PDUResource.dispatch_outlet_data"><a class="viewcode-back" href="../../api.html#api.api.PDUResource.dispatch_outlet_data">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_outlet_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OutletDataResource</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="OutletResource"><a class="viewcode-back" href="../../api.html#api.api.OutletResource">[docs]</a><span class="k">class</span> <span class="nc">OutletResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An outlet on a PDU.</span>

<span class="sd">    Note: this resource is always nested under a PDUResource and is not bound</span>
<span class="sd">    into the normal namespace for the API.&quot;&quot;&quot;</span>

    <span class="n">pdu</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToOneField</span><span class="p">(</span><span class="n">PDUResource</span><span class="p">,</span> <span class="s">&#39;device&#39;</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">()</span>
    <span class="n">leaf</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">device_uri</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

<div class="viewcode-block" id="OutletResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;outlet&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">OutletRef</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s">&#39;outletID&#39;</span>
        <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;pdu&#39;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
            <span class="s">&#39;outletID&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
            <span class="s">&#39;outletName&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OutletResource.obj_get"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;outletID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atdecode</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;outletID&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">build_time_filters</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">object_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_list</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-end_time&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">OutletResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OutletResource.build_filters"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.build_filters">[docs]</a>    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">OutletResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="n">build_time_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">orm_filters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">orm_filters</span>
</div>
<div class="viewcode-block" id="OutletResource.alter_list_data_to_serialize"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.alter_list_data_to_serialize">[docs]</a>    <span class="k">def</span> <span class="nf">alter_list_data_to_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify resource object default format before this is returned </span>
<span class="sd">        and serialized as json.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;children&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="OutletResource.get_resource_uri"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the resource uri element that is returned in json payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span>

        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">PDUResource</span><span class="p">()</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                <span class="s">&#39;outlet/&#39;</span><span class="p">,</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">outletID</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">uri</span>
</div>
<div class="viewcode-block" id="OutletResource.dehydrate_children"><a class="viewcode-back" href="../../api.html#api.api.OutletResource.dehydrate_children">[docs]</a>    <span class="k">def</span> <span class="nf">dehydrate_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;load&#39;</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">base_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">leaf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">children</span> <span class="p">]</span>

</div></div>
<div class="viewcode-block" id="OutletDataObject"><a class="viewcode-back" href="../../api.html#api.api.OutletDataObject">[docs]</a><span class="k">class</span> <span class="nc">OutletDataObject</span><span class="p">(</span><span class="n">DataObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulation for outlet data.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="OutletDataResource"><a class="viewcode-back" href="../../api.html#api.api.OutletDataResource">[docs]</a><span class="k">class</span> <span class="nc">OutletDataResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data for an outlet on a PDU.</span>

<span class="sd">    Note: this resource is always nested under a PDURessource and is not bound</span>
<span class="sd">    into the normal namespace for the API.&quot;&quot;&quot;</span>

    <span class="n">begin_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&quot;begin_time&quot;</span><span class="p">)</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&quot;end_time&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="OutletDataResource.Meta"><a class="viewcode-back" href="../../api.html#api.api.OutletDataResource.Meta">[docs]</a>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s">&#39;outlet_data&#39;</span>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;get&#39;</span><span class="p">]</span>
        <span class="n">object_class</span> <span class="o">=</span> <span class="n">OutletDataObject</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">AnonymousGetElseApiAuthentication</span><span class="p">()</span>
        <span class="n">throttle</span> <span class="o">=</span> <span class="n">AnonymousThrottle</span><span class="p">(</span><span class="o">**</span><span class="n">THROTTLE_ARGS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OutletDataResource.get_resource_uri"><a class="viewcode-back" href="../../api.html#api.api.OutletDataResource.get_resource_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_or_obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bundle_or_obj</span><span class="p">,</span> <span class="n">Bundle</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span><span class="o">.</span><span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle_or_obj</span>


        <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">OutletResource</span><span class="p">()</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">outlet</span><span class="p">),</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">outlet_dataset</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uri</span>
</div>
<div class="viewcode-block" id="OutletDataResource.obj_get"><a class="viewcode-back" href="../../api.html#api.api.OutletDataResource.obj_get">[docs]</a>    <span class="k">def</span> <span class="nf">obj_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">outlet_id</span> <span class="o">=</span> <span class="n">atdecode</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;outlet_id&#39;</span><span class="p">])</span>
        <span class="n">outlet_dataset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;outlet_dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">outlet</span> <span class="o">=</span> <span class="n">OutletResource</span><span class="p">()</span><span class="o">.</span><span class="n">obj_get</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span>
                <span class="n">device__name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">outletID</span><span class="o">=</span><span class="n">outlet_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OutletRef</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;no such device/oulet: dev: {0} outlet: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">outlet_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">outlet_dataset</span> <span class="o">!=</span> <span class="s">&#39;load&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">(</span><span class="s">&quot;no such dataset: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outlet_dataset</span><span class="p">))</span>

        <span class="n">oidset_name</span> <span class="o">=</span> <span class="s">&#39;SentryPoll&#39;</span>
        <span class="n">datapath</span> <span class="o">=</span> <span class="p">[</span><span class="n">SNMP_NAMESPACE</span><span class="p">,</span> <span class="n">outlet</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">oidset_name</span><span class="p">,</span> <span class="s">&#39;outletLoadValue&#39;</span><span class="p">,</span> <span class="n">outlet_id</span><span class="p">]</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">OutletDataObject</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">outlet</span> <span class="o">=</span> <span class="n">outlet</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="n">datapath</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">outlet_dataset</span> <span class="o">=</span> <span class="n">outlet_dataset</span>

        <span class="n">oidset</span> <span class="o">=</span> <span class="n">outlet</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">oidsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">oidset_name</span><span class="p">)</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bundle</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c"># Make sure incoming begin/end timestamps are ints</span>
        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;begin&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">oidset</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidset</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query_raw_data</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span> <span class="n">oidset</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
                                 <span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="n">format_data_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">coerce_to_bins</span><span class="o">=</span><span class="n">oidset</span><span class="o">.</span><span class="n">frequency</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Fill</span><span class="o">.</span><span class="n">verify_fill</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">oidset</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
                                    <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>
</div>
<span class="sd">&quot;&quot;&quot;Connect the &#39;root&#39; resources to the URL schema.&quot;&quot;&quot;</span>
<span class="n">v1_api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">api_name</span><span class="o">=</span><span class="s">&#39;v1&#39;</span><span class="p">)</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DeviceResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">TimeseriesResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OidsetResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">InterfaceResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OidsetEndpointResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BulkDispatch</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PDUResource</span><span class="p">())</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OutletResource</span><span class="p">())</span>

<span class="n">__doc__</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">snmp_ns_doc</span><span class="p">,</span> <span class="n">bulk_ns_doc</span><span class="p">,</span> <span class="n">bulk_interface_ns_doc</span><span class="p">,</span> <span class="n">ts_ns_doc</span><span class="p">,</span> <span class="n">bulk_namespace_ns_doc</span><span class="p">])</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2013, The Regents of the University of California.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>